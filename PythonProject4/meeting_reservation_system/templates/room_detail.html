<!DOCTYPE html>
<html>
<head>
    <title>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ {{ room.name }}</title>
    <style>
        /* (–æ—Å—Ç–∞–≤–∏–ª —Ç–≤–æ–π CSS –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: #e0e0e0;
            min-height: 100vh;
        }

        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #2d2d2d;
            color: #e0e0e0;
            border: 1px solid #404040;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            z-index: 1000;
        }
        .back-button:hover {
            background: #3a3a3a;
            border-color: #007bff;
        }
        .booking-container {
            display: flex;
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .left-column {
            flex: 1;
        }
        .equipment-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 15px;
        }
        .equipment-column {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .equipment-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: #3a3a3a;
            border-radius: 6px;
            border-left: 3px solid #007bff;
        }
        .equipment-icon {
            color: #28a745;
            font-weight: bold;
            font-size: 16px;
        }
        .right-column {
            flex: 1;
            background: #2d2d2d;
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #404040;
        }
        .room-image {
            margin-top: 13.5px;
            width: 105%;
            margin-left: -8.48%;
            border-radius: 10px;
            margin-bottom: 20px;
            transform: scale(1.059);
        }
        .tabs {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            margin-left: -11.5%
        }
        .tab {
            padding: 12px 20px;
            background: #2d2d2d;
            border-radius: 8px;
            cursor: pointer;
            border: 1px solid #404040;
            transition: all 0.3s;
        }
        .tab.active {
            background: #007bff;
            border-color: #007bff;
        }
        .tab:hover {
            background: #3a3a3a;
        }
        .tab-content {
            display: none;
            background: #2d2d2d;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #404040;
            margin-left: -11.5%
        }
        .tab-content.active {
            display: block;
        }

        /* –ö–∞–ª–µ–Ω–¥–∞—Ä—å */
        .calendar {
            background: #3a3a3a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .calendar-nav {
            background: none;
            border: none;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
            padding: 5px 10px;
        }
        .calendar-nav:hover {
            background: #4a4a4a;
            border-radius: 5px;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        .calendar-day {
            padding: 10px;
            text-align: center;
            border-radius: 5px;
            cursor: pointer;
        }
        .calendar-day:hover {
            background: #4a4a4a;
        }
        .calendar-day.selected {
            background: #007bff;
        }
        .calendar-day.disabled {
            color: #666;
            cursor: not-allowed;
        }
        .calendar-day.other-month {
            color: #666;
        }

        /* –í—Ä–µ–º—è */
        .time-section, .duration-section {
            margin: 25px 0;
        }
        .time-grid, .duration-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        .time-slot, .duration-btn {
            padding: 12px;
            text-align: center;
            background: #3a3a3a;
            border-radius: 8px;
            cursor: pointer;
            border: 1px solid #555;
            transition: all 0.3s;
        }
        .time-slot:hover, .duration-btn:hover {
            background: #4a4a4a;
        }
        .time-slot.selected, .duration-btn.selected {
            background: #28a745;
            border-color: #28a745;
        }
        .time-slot.disabled {
            background: #dc3545;
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* –°–≤–æ–¥–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è */
        .booking-summary {
            background: #3a3a3a;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #007bff;
        }
        .booking-summary h4 {
            margin: 0 0 15px 0;
            color: #fff;
        }
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
        }
        .total-price {
            font-size: 18px;
            font-weight: bold;
            color: #28a745;
            border-top: 1px solid #555;
            padding-top: 10px;
            margin-top: 10px;
        }

        /* –§–æ—Ä–º–∞ */
        .contact-form {
            margin-top: 25px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #ccc;
            font-weight: bold;
        }
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            background: #3a3a3a;
            border: 1px solid #555;
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            box-sizing: border-box;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        .btn-submit {
            background: #28a745;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            transition: background 0.3s;
        }
        .btn-submit:hover:not(:disabled) {
            background: #218838;
        }
        .btn-submit:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
    </style>
</head>
<body>
<!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ -->
<button class="back-button" onclick="window.history.back()">‚Üê –ù–∞–∑–∞–¥</button>

<div class="booking-container">
    <!-- –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê -->
    <div class="left-column">
        <img src="{{ room.image.url }}" alt="{{ room.name }}" class="room-image">

        <div class="tabs">
            <div class="tab active" data-tab="services">–£—Å–ª—É–≥–∏</div>
            <div class="tab" data-tab="price">–¶–µ–Ω–∞</div>
            <div class="tab" data-tab="location">–ú–µ—Å—Ç–æ—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ</div>
            <div class="tab" data-tab="reviews">–û—Ç–∑—ã–≤—ã</div>
            <div class="tab" data-tab="features">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</div>
        </div>

        <div id="services" class="tab-content active">
            <h3>–£—Å–ª—É–≥–∏ –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</h3>
            {% if room.equipment %}
                <div class="equipment-columns">
                    <div class="equipment-column">
                        {% for item in room.get_equipment_columns.0 %}
                        <div class="equipment-item">
                            <span class="equipment-icon">‚úì</span>
                            {{ item }}
                        </div>
                        {% endfor %}
                    </div>
                    <div class="equipment-column">
                        {% for item in room.get_equipment_columns.1 %}
                        <div class="equipment-item">
                            <span class="equipment-icon">‚úì</span>
                            {{ item }}
                        </div>
                        {% endfor %}
                    </div>
                </div>
            {% else %}
                <p>–û–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥ –ø–æ—è–≤–∏—Ç—Å—è —Å–∫–æ—Ä–æ...</p>
            {% endif %}
        </div>

        <div id="price" class="tab-content">
            <h3>–°—Ç–æ–∏–º–æ—Å—Ç—å</h3>
            <p><strong>{{ room.price_per_hour }} —Ä—É–±/—á–∞—Å</strong></p>
            <p>–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: 1 —á–∞—Å</p>
            <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: 4 —á–∞—Å–∞</p>
        </div>
        {% if room.office %}
        <div id="location" class="tab-content" >
            <h3>–ú–µ—Å—Ç–æ—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ</h3>
            <p><strong>–û—Ñ–∏—Å:</strong> {{ room.office.name }}</p>
            <p><strong>–ê–¥—Ä–µ—Å:</strong> {{ room.office.address }}</p>
            <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ room.office.phone }}</p>
            <p><strong>–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã:</strong> {{ room.office.work_hours }}</p>

            {% if room.office.transport %}
                <p><strong>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç —Ä—è–¥–æ–º:</strong> {{ room.office.transport }}</p>
            {% endif %}

            {% if room.office.parking %}
                <p><strong>–ü–∞—Ä–∫–æ–≤–∫–∞:</strong> {{ room.office.parking }}</p>
            {% endif %}

            <iframe style="width:100%; height:300px; border-radius:10px; margin-top:10px;"
                src="https://yandex.ru/map-widget/v1/?ll={{ room.office.longitude }}%2C{{ room.office.latitude }}&z=16&l=map"
                frameborder="0">
            </iframe>
            {% if room.office.yandex_map_url %}
            <a href="{{ room.office.yandex_map_url }}" target="_blank"
               style="display:inline-block; margin-top:10px; padding:10px 15px; background:#2E9CF8;
                      color:white; border-radius:8px; text-decoration:none;">
                üîé –û—Ç–∫—Ä—ã—Ç—å –≤ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç–∞—Ö
            </a>
            {% endif %}
        </div>
        {% endif %}

        <div id="reviews" class="tab-content">
            <h3>–û—Ç–∑—ã–≤—ã</h3>
            <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–∑—ã–≤—ã –æ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–Ω–æ–π –∫–æ–º–Ω–∞—Ç–µ</p>
        </div>

        <div id="features" class="tab-content">
            <h3>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h3>
            <p>üë• –í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: –¥–æ {{ room.capacity }} —á–µ–ª–æ–≤–µ–∫</p>
            <p>üéØ –ö–∞—Ç–µ–≥–æ—Ä–∏—è:
                {% if room.category == 'economy' %}üü¢ –≠–∫–æ–Ω–æ–º
                {% elif room.category == 'standard' %}üîµ –°—Ç–∞–Ω–¥–∞—Ä—Ç
                {% elif room.category == 'comfort' %}üü° –ö–æ–º—Ñ–æ—Ä—Ç
                {% elif room.category == 'vip' %}üü£ VIP
                {% elif room.category == 'luxury' %}üî¥ –õ—é–∫—Å
                {% endif %}
            </p>
        </div>
    </div>

    <!-- –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê - –§–û–†–ú–ê –ë–†–û–ù–ò–†–û–í–ê–ù–ò–Ø -->
    <div class="right-column">
        <h2 style="margin-top: 0; color: #fff;">–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ {{ room.name }}</h2>

             {% if messages %}
        <div style="margin-bottom: 20px;">
            {% for message in messages %}
            <div style="
                background: {% if 'error' in message.tags %} #dc3545 {% else %} #28a745 {% endif %};
                color: white;
                padding: 15px;
                border-radius: 10px;
                margin-bottom: 15px;
                border: 2px solid {% if 'error' in message.tags %} #c82333 {% else %} #218838 {% endif %};
                font-weight: bold;
                text-align: center;
            ">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <form class="booking-form" method="POST" action="{% url 'create_booking' %}">
            {% csrf_token %}

            <input type="hidden" name="room_id" value="{{ room.id }}">

            <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
            <input type="hidden" name="selected_date" id="selectedDate">
            <input type="hidden" name="start_time" id="startTime">
            <input type="hidden" name="duration" id="duration">

            <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
            <div class="calendar">
                <div class="calendar-header">
                    <button type="button" class="calendar-nav" onclick="changeMonth(-1)">‚Üê</button>
                    <h3 id="currentMonth" style="margin: 0;">–ù–æ—è–±—Ä—å 2024</h3>
                    <button type="button" class="calendar-nav" onclick="changeMonth(1)">‚Üí</button>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>

            <!-- –í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞ -->
            <div class="time-section">
                <h3>–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞</h3>
                <div class="time-grid" id="timeGrid">
                    <!-- –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>

            <!-- –í—ã–±–æ—Ä –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ -->
            <div class="duration-section">
                <h3>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</h3>
                <div class="duration-buttons" id="durationButtons">
                    <button type="button" class="duration-btn" data-hours="1">1 —á–∞—Å</button>
                    <button type="button" class="duration-btn" data-hours="2">2 —á–∞—Å–∞</button>
                    <button type="button" class="duration-btn" data-hours="3">3 —á–∞—Å–∞</button>
                    <button type="button" class="duration-btn" data-hours="4">4 —á–∞—Å–∞</button>
                </div>
            </div>

            <!-- –°–≤–æ–¥–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
            <div class="booking-summary" id="bookingSummary" style="display: none;">
                <h4>üìÖ –°–≤–æ–¥–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h4>
                <div class="summary-item">
                    <span>–î–∞—Ç–∞:</span>
                    <span id="summaryDate">-</span>
                </div>
                <div class="summary-item">
                    <span>–í—Ä–µ–º—è:</span>
                    <span id="summaryTime">-</span>
                </div>
                <div class="summary-item">
                    <span>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</span>
                    <span id="summaryDuration">-</span>
                </div>
                <div class="summary-item">
                    <span>–°—Ç–æ–∏–º–æ—Å—Ç—å:</span>
                    <span id="summaryPrice">-</span>
                </div>
                <div class="summary-item total-price">
                    <span>–ò–¢–û–ì–û:</span>
                    <span id="totalPrice">0 —Ä—É–±</span>
                </div>
            </div>

            <!-- –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
            <div class="contact-form">
                <h3>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>

                <div class="form-group">
                    <label>–§–ò–û *</label>
                    <input type="text" name="full_name" required placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" value="{{ user.get_full_name }}">
                </div>

                <div class="form-group">
                    <label>–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                    <input type="tel" name="phone" required placeholder="+7 (999) 999-99-99" value="{{ user.phone }}">
                </div>

                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required placeholder="example@mail.ru" value="{{ user.email }}">
                </div>

                <div class="form-group">
                    <label>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è</label>
                    <textarea name="comment" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ, –∫–µ–π—Ç–µ—Ä–∏–Ω–≥, –æ—Å–æ–±—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è..."></textarea>
                </div>

                <button type="submit" class="btn-submit" id="submitBtn" disabled>–û–¢–ü–†–ê–í–ò–¢–¨ –ó–ê–ü–†–û–° –ù–ê –ë–†–û–ù–ò–†–û–í–ê–ù–ò–ï</button>
            </div>
        </form>
    </div>
</div>

<script>


    // --- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let currentDate = new Date();
    let selectedDate = null;      // Date –æ–±—ä–µ–∫—Ç (–ª–æ–∫–∞–ª—å–Ω—ã–π)
    let selectedTime = null;      // —Å—Ç—Ä–æ–∫–∞ '09:00'
    let selectedDuration = null;  // —á–∏—Å–ª–æ —á–∞—Å–æ–≤
    const roomPricePerHour = {{ room.price_per_hour }};
    const roomId = {{ room.id }};

    // --- –¢–∞–±—ã
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById(tab.dataset.tab).classList.add('active');
        });
    });

    // --- –ö–ê–õ–ï–ù–î–ê–†–¨
    function renderCalendar() {
        const monthNames = ["–Ø–Ω–≤–∞—Ä—å", "–§–µ–≤—Ä–∞–ª—å", "–ú–∞—Ä—Ç", "–ê–ø—Ä–µ–ª—å", "–ú–∞–π", "–ò—é–Ω—å", "–ò—é–ª—å", "–ê–≤–≥—É—Å—Ç", "–°–µ–Ω—Ç—è–±—Ä—å", "–û–∫—Ç—è–±—Ä—å", "–ù–æ—è–±—Ä—å", "–î–µ–∫–∞–±—Ä—å"];
        document.getElementById('currentMonth').textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;

        const calendarGrid = document.getElementById('calendarGrid');
        calendarGrid.innerHTML = '';

        // –ó–∞–≥–æ–ª–æ–≤–∫–∏ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏
        const days = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
        days.forEach(day => {
            const dayElement = document.createElement('div');
            dayElement.textContent = day;
            dayElement.style.fontWeight = 'bold';
            dayElement.style.color = '#ccc';
            calendarGrid.appendChild(dayElement);
        });

        // –î–Ω–∏ –º–µ—Å—è—Ü–∞
        const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
        const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);

        // –ü—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –¥–Ω–µ–º (—Å–¥–≤–∏–≥ –ø–æ ISO-–Ω–µ–¥–µ–ª–µ: –ü–Ω..–í—Å)
        for (let i = 0; i < (firstDay.getDay() + 6) % 7; i++) {
            const emptyDay = document.createElement('div');
            emptyDay.classList.add('calendar-day', 'other-month');
            calendarGrid.appendChild(emptyDay);
        }

        // –î–Ω–∏ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        for (let day = 1; day <= lastDay.getDate(); day++) {
            const dayElement = document.createElement('div');
            dayElement.textContent = day;
            dayElement.classList.add('calendar-day');

            const cellDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
            cellDate.setHours(0, 0, 0, 0);

            // –û—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–æ—à–µ–¥—à–∏–µ –¥–∞—Ç—ã
            if (cellDate < today) {
                dayElement.classList.add('disabled');
            } else {
                dayElement.addEventListener('click', () => selectDate(day, cellDate));

                // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞—Ç)
                if (selectedDate && cellDate.getTime() === selectedDate.getTime()) {
                    dayElement.classList.add('selected');
                }
            }

            calendarGrid.appendChild(dayElement);
        }
    }

    function changeMonth(direction) {
        currentDate.setMonth(currentDate.getMonth() + direction);
        renderCalendar();
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ –º–µ—Å—è—Ü–∞
        resetTimeSelection();
    }

    function selectDate(day, date) {
        // date ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–π Date —Å 00:00 —á–∞—Å–æ–≤ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
        selectedDate = date;
        renderCalendar();

        // –ó–ê–ü–ò–°–´–í–ê–ï–ú –≤ —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ª–æ–∫–∞–ª—å–Ω—É—é –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD (–±–µ–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–π –≤ UTC)
        document.getElementById('selectedDate').value = formatDate(selectedDate);

        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        selectedTime = null;
        selectedDuration = null;
        document.querySelectorAll('.duration-btn').forEach(btn => {
            btn.classList.remove('selected');
        });
        // –û—á–∏—â–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
        document.getElementById('timeGrid').innerHTML = '';

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã
        loadAvailableTimes();

        updateBookingSummary();
    }

    // --- –í–†–ï–ú–Ø - –ó–ê–ü–†–û–° –î–û–°–¢–£–ü–ù–û–°–¢–ò
    function loadAvailableTimes() {
        if (!selectedDate) return;

        const timeGrid = document.getElementById('timeGrid');
        timeGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏...</div>';
        timeGrid.classList.add('loading');

        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ ‚Äî –õ–û–ö–ê–õ–¨–ù–ê–Ø –¥–∞—Ç–∞ –±–µ–∑ —Å–º–µ—â–µ–Ω–∏–π
        const dateStr = formatDate(selectedDate);

        fetch(`/api/available-times/${roomId}/?date=${dateStr}`)
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                throw new Error(data.error);
            }
            // –æ—Ç–ª–∞–¥–∫–∞ (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
            // console.log('–î–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞:', data);
            generateTimeSlots(data.available_times || [], data.booked_times || []);
            timeGrid.classList.remove('loading');
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Ä–µ–º–µ–Ω–∏:', error);
            timeGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 20px; color: #dc3545;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Ä–µ–º–µ–Ω–∏</div>';
            timeGrid.classList.remove('loading');
        });
    }

    function generateTimeSlots(availableTimes, bookedTimes) {
        const timeGrid = document.getElementById('timeGrid');
        timeGrid.innerHTML = '';

        const allTimeSlots = ['09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00'];

        allTimeSlots.forEach(time => {
            const timeSlot = document.createElement('div');
            timeSlot.textContent = time;
            timeSlot.classList.add('time-slot');
            timeSlot.dataset.time = time;

            const isAvailable = availableTimes.includes(time);
            const isBooked = bookedTimes.includes(time);

            if (isAvailable) {
                // –ü–µ—Ä–µ–¥–∞—ë–º –∏–≤–µ–Ω—Ç-—ç–ª–µ–º–µ–Ω—Ç –≤ selectTime, —á—Ç–æ–±—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥—Å–≤–µ—Ç–∏—Ç—å
                timeSlot.addEventListener('click', (e) => selectTime(time, e.currentTarget));

                if (selectedTime === time) {
                    timeSlot.classList.add('selected');
                }
            } else {
                timeSlot.classList.add('disabled');
                if (isBooked) {
                    timeSlot.title = 'üö´ –≠—Ç–æ –≤—Ä–µ–º—è —É–∂–µ –∑–∞–Ω—è—Ç–æ';
                } else {
                    timeSlot.title = '‚ùå –í—Ä–µ–º—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ';
                }
            }

            timeGrid.appendChild(timeSlot);
        });

        if (availableTimes.length === 0) {
            timeGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 20px; color: #dc3545;">üö´ –ù–∞ —ç—Ç—É –¥–∞—Ç—É –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏</div>';
        }
    }

    function selectTime(time, el) {
        selectedTime = time;

        // –°–±—Ä–æ—Å –≤—ã–¥–µ–ª–µ–Ω–∏—è
        document.querySelectorAll('.time-slot').forEach(slot => {
            slot.classList.remove('selected');
        });

        // –ü–æ–¥—Å–≤–µ—Ç–∏—Ç—å —Ç–µ–∫—É—â–∏–π —ç–ª–µ–º–µ–Ω—Ç (–µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω)
        if (el) {
            el.classList.add('selected');
        } else {
            // –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π ‚Äî –ø–æ–ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —Å–ª–æ—Ç –ø–æ data-time
            const found = document.querySelector(`.time-slot[data-time="${time}"]`);
            if (found) found.classList.add('selected');
        }

        document.getElementById('startTime').value = selectedTime;
        updateBookingSummary();
    }

    // --- –ü–†–û–î–û–õ–ñ–ò–¢–ï–õ–¨–ù–û–°–¢–¨
    document.querySelectorAll('.duration-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            selectedDuration = parseInt(btn.dataset.hours, 10);

            document.querySelectorAll('.duration-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');

            document.getElementById('duration').value = selectedDuration;

            updateBookingSummary();
        });
    });

    // --- –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–í–û–î–ö–ò
    function updateBookingSummary() {
        const summary = document.getElementById('bookingSummary');
        const submitBtn = document.getElementById('submitBtn');

        if (selectedDate && selectedTime && selectedDuration) {
            summary.style.display = 'block';

            document.getElementById('summaryDate').textContent = formatDateDisplay(selectedDate);
            document.getElementById('summaryTime').textContent = `${selectedTime} - ${calculateEndTime()}`;
            document.getElementById('summaryDuration').textContent = `${selectedDuration} —á–∞—Å${selectedDuration > 1 ? '–∞' : ''}`;

            const totalPrice = roomPricePerHour * selectedDuration;
            document.getElementById('summaryPrice').textContent = `${roomPricePerHour} —Ä—É–±/—á–∞—Å √ó ${selectedDuration} = ${totalPrice} —Ä—É–±`;
            document.getElementById('totalPrice').textContent = `${totalPrice} —Ä—É–±`;

            submitBtn.disabled = false;
        } else {
            summary.style.display = 'none';
            submitBtn.disabled = true;
        }
    }

    function calculateEndTime() {
        if (!selectedTime || !selectedDuration) return '-';
        const [hours, minutes] = selectedTime.split(':').map(Number);
        const endHours = hours + selectedDuration;
        return `${endHours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
    }

    function resetTimeSelection() {
        selectedTime = null;
        selectedDuration = null;
        document.getElementById('timeGrid').innerHTML = '';
        document.querySelectorAll('.duration-btn').forEach(btn => btn.classList.remove('selected'));
        updateBookingSummary();
    }

    // --- –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –î–ê–¢
    // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É YYYY-MM-DD –ª–æ–∫–∞–ª—å–Ω–æ–π –¥–∞—Ç—ã (–±–µ–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ UTC)
    function formatDate(date) {
        const y = date.getFullYear();
        const m = (date.getMonth() + 1).toString().padStart(2, '0');
        const d = date.getDate().toString().padStart(2, '0');
        return `${y}-${m}-${d}`;
    }

    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–∞—è –¥–∞—Ç–∞ –≤ —Å–≤–æ–¥–∫–µ: DD.MM.YYYY
    function formatDateDisplay(date) {
        const y = date.getFullYear();
        const m = (date.getMonth() + 1).toString().padStart(2, '0');
        const d = date.getDate().toString().padStart(2, '0');
        return `${d}.${m}.${y}`;
    }

    // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    renderCalendar();

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –∫–∞–∫ –≤—ã–±—Ä–∞–Ω–Ω—É—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    const today = new Date();
    today.setHours(0,0,0,0);
    // –ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –±—ã–ª–∞ –≤—ã–±—Ä–∞–Ω–∞ –¥–∞—Ç–∞ ‚Äî –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ–∫—É
    selectDate(today.getDate(), today);

</script>
</body>
</html>
