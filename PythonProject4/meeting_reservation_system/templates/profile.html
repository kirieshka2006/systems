<!DOCTYPE html>
<html>
<head>
    <title>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</title>
    <style>
        body {
            background: #1a1a1a;
            color: #e0e0e0;
            font-family: Arial, sans-serif;
            padding: 40px;
            min-height: 100vh;
        }

        .profile-container {
            max-width: 900px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
        }
        select {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 1px solid #404040;
            background: #1a1a1a;
            color: #e0e0e0;
            font-size: 14px;
            transition: all 0.3s;
        }

        select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }

        input[type="date"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 1px solid #404040;
            background: #1a1a1a;
            color: #e0e0e0;
            font-size: 14px;
            transition: all 0.3s;
        }

        input[type="date"]:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }

        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0.8);
            cursor: pointer;
        }

        option {
            background: #1a1a1a;
            color: #e0e0e0;
        }
        .profile-sidebar {
            background: #2d2d2d;
            padding: 30px;
            border-radius: 15px;
            border: 1px solid #404040;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            text-align: center;
            height: fit-content;
        }

        .profile-main {
            background: #2d2d2d;
            padding: 30px;
            border-radius: 15px;
            border: 1px solid #404040;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .avatar-section {
            margin-bottom: 25px;
            position: relative;
        }

        .avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 4px solid #007bff;
            object-fit: cover;
            margin: 0 auto 15px;
            display: block;
        }

        .edit-avatar-btn {
            position: absolute;
            bottom: 10px;
            right: calc(50% - 75px);
            background: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            font-size: 16px;
        }

        .user-info {
            text-align: center;
            margin-bottom: 25px;
        }

        .username {
            color: #fff;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .user-role {
            color: #007bff;
            font-size: 14px;
            background: rgba(0, 123, 255, 0.1);
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 25px 0;
        }

        .stat-item {
            background: #3a3a3a;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #555;
        }

        .stat-value {
            color: #007bff;
            font-size: 18px;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            color: #ccc;
            font-size: 11px;
            margin-top: 5px;
        }

        .info-item {
            background: #3a3a3a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #007bff;
        }

        .info-label {
            color: #ccc;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .info-value {
            color: #fff;
            font-size: 16px;
            font-weight: bold;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            color: #fff;
            font-size: 18px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #404040;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .section-title-text {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .edit-btn {
            background: #007bff;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .edit-btn:hover {
            background: #0056b3;
        }

        .form-group {
            margin-bottom: 20px;
            width: 94%;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #ccc;
            font-weight: bold;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="file"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 1px solid #555;
            background: #3a3a3a;
            color: #fff;
            font-size: 14px;
            transition: all 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }

        input:disabled {
            background: #2d2d2d;
            color: #999;
            cursor: not-allowed;
        }

        .btn {
            background: #007bff;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
        }

        .btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .btn-cancel {
            background: #6c757d;
        }

        .btn-cancel:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .file-upload {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-upload-btn {
            background: #3a3a3a;
            border: 1px dashed #555;
            color: #ccc;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .file-upload-btn:hover {
            border-color: #007bff;
            color: #007bff;
        }

        .file-upload input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
            height: 100%;
        }

        /* –°–¢–ò–õ–ò –î–õ–Ø –°–û–û–ë–©–ï–ù–ò–ô */
        .messages {
            margin: 20px 0;
        }

        .message {
            background: #3a3a3a;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #007bff;
        }

        .message.error {
            border-left-color: #dc3545;
            background: rgba(220, 53, 69, 0.1);
        }

        .message.success {
            border-left-color: #28a745;
            background: rgba(40, 167, 69, 0.1);
        }

        .back-link {
            color: #007bff;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .back-link:hover {
            color: #0056b3;
            text-decoration: underline;
        }

        .edit-form {
            display: none;
            background: #3a3a3a;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
            border: 1px solid #555;
        }

        .edit-form.active {
            display: block;
        }

        .form-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .profile-container {
                grid-template-columns: 1fr;
            }

            body {
                padding: 20px;
            }

            .form-actions {
                grid-template-columns: 1fr;
            }
        }
        .profile-sidebar {
    grid-column: 1;
    grid-row: 1;
}
        .profile-main {
    grid-column: 2;
    grid-row: 1 / span 2;
}
.profile-container {
    display: grid;
    grid-template-columns: 280px 1fr;
    grid-template-rows: auto auto;
    gap: 10px 30px;
}

.btn-2{            background: #007bff;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width:107%;}


.profile-sidebar > div:has(.history-btn) {
    margin-left: -30px;
    margin-right: -30px;
    padding-left: 30px;
    padding-right: 30px;
    margin-top: 20px;
}

.history-btn {
    background: #28a745;
    color: white;
    padding: 15px 20px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s;
    display: block;
    font-size: 16px;
    width: 100% ;
    max-width: 100%;
    box-sizing: border-box;
    text-align: center;
    text-decoration: none;
    margin: 0;
}

.history-btn:hover {
    background: #218838;
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ */
.profile-sidebar > div:last-of-type {
    width: 100%;
    margin-left: 0;
    margin-right: 0;
    padding: 0;
}
    </style>

</head>
<body>
    <div class="profile-container">
        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π -->
        <div class="profile-sidebar">
            <div class="avatar-section">
                {% if user.avatar %}
                    <img src="{{ user.avatar.url }}" alt="Avatar" class="avatar">
                {% else %}
                    <img src="/static/default-avatar.png" alt="Avatar" class="avatar">
                {% endif %}
                <button class="edit-avatar-btn" onclick="openEditSection('avatar')">‚úèÔ∏è</button>
            </div>

            <div class="user-info">
                <div class="username">{{ user.username }}</div>
                <div class="user-role">{{ user.get_role_display }}</div>
            </div>

            <div class="stats">
                <div class="stat-item">
                    <span class="stat-value">{{ bookings_count }}</span>
                    <span class="stat-label">–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">{{ activity_percentage }}%</span>
                    <span class="stat-label">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</span>
                </div>
            </div>
            <!-- –î–û–ë–ê–í–¨ –≠–¢–û–¢ –ë–õ–û–ö –°–Æ–î–ê -->
            <div class="user-details">
                <div style="margin-bottom: 15px;">
                    <strong>üìß Email:</strong><br>
                    {{ user.email|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}
                </div>
                {% if user.phone %}
                <div style="margin-bottom: 15px;">
                    <strong>üìû –¢–µ–ª–µ—Ñ–æ–Ω:</strong><br>
                    {{ user.phone }}
                </div>
                {% endif %}
            </div>
            <!-- –ò—Å—Ç–æ—Ä–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
            <div style="margin: 30px -30px 0 -30px; padding: 0 30px;">
    <a href="{% url 'booking_history' %}" class="history-btn" style="text-decoration: none; display: block;">
        üìÖ –ò—Å—Ç–æ—Ä–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    </a>
</div>
             <!-- –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –ö–ù–û–ü–û–ö -->
                    <a href="{% url 'home' %}" class="back-link">
                                    ‚Üê –ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                    </a>

        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
        <div class="profile-main">
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä) -->
            <div class="section">
                <div class="section-title">
                    <div class="section-title-text">
                        <i>üë§</i> –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                    </div>
                    <button class="edit-btn" onclick="openEditSection('profile')">
                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>

                <div class="info-item">
                    <div class="info-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>
                    <div class="info-value">{{ user.username }}</div>
                </div>

                <div class="info-item">
                    <div class="info-label">Email</div>
                    <div class="info-value">{{ user.email|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</div>
                </div>

                <div class="info-item">
                    <div class="info-label">–†–æ–ª—å</div>
                    <div class="info-value">{{ user.get_role_display }}</div>
                </div>

                {% if user.phone %}
                <div class="info-item">
                    <div class="info-label">–¢–µ–ª–µ—Ñ–æ–Ω</div>
                    <div class="info-value">{{ user.phone }}</div>
                </div>
                {% endif %}

                {% if user.first_name %}
                <div class="info-item">
                    <div class="info-label">–ò–º—è</div>
                    <div class="info-value">{{ user.first_name }}</div>
                </div>
                {% endif %}

                {% if user.last_name %}
                <div class="info-item">
                    <div class="info-label">–§–∞–º–∏–ª–∏—è</div>
                    <div class="info-value">{{ user.last_name }}</div>
                </div>
                {% endif %}

                {% if user.patronymic %}
                <div class="info-item">
                    <div class="info-label">–û—Ç—á–µ—Å—Ç–≤–æ</div>
                    <div class="info-value">{{ user.patronymic }}</div>
                </div>
                {% endif %}

                {% if user.birth_date %}
                <div class="info-item">
                    <div class="info-label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</div>
                    <div class="info-value">{{ user.birth_date|date:"d.m.Y" }}</div>
                </div>
                {% endif %}

                {% if user.gender %}
                <div class="info-item">
                    <div class="info-label">–ü–æ–ª</div>
                    <div class="info-value">
                        {% if user.gender == 'M' %}–ú—É–∂—Å–∫–æ–π
                        {% elif user.gender == 'F' %}–ñ–µ–Ω—Å–∫–∏–π
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            </div>
<!-- ‚òÖ‚òÖ‚òÖ –í–°–¢–ê–í–¨ –ó–î–ï–°–¨ –§–û–†–ú–£ –ê–í–ê–¢–ê–†–ö–ò ‚òÖ‚òÖ‚òÖ -->
<div class="edit-form" id="editAvatarForm">
    <div class="section-title">
        <div class="section-title-text">
            <i>üñºÔ∏è</i> –°–º–µ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏
        </div>
    </div>

    <form method="post" enctype="multipart/form-data" action="{% url 'update_avatar' %}">
        {% csrf_token %}

        <div class="form-group">
            <label>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—É—é –∞–≤–∞—Ç–∞—Ä–∫—É:</label>
            <div class="file-upload">
                <div class="file-upload-btn">
                    üìÅ –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª
                    <input type="file" name="avatar" accept="image/*">
                </div>
            </div>
        </div>

        <div class="form-actions">
            <button type="button" class="btn btn-cancel" onclick="closeEditSection('avatar')">
                ‚ùå –û—Ç–º–µ–Ω–∞
            </button>
            <button type="submit" class="btn btn-success">
                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É
            </button>
        </div>
    </form>
</div>
            <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
<div class="section">
    <div class="edit-form" id="editProfileForm">
        <div class="section-title">
            <div class="section-title-text">
                <i>‚úèÔ∏è</i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
            </div>
        </div>

         <!-- ‚òÖ‚òÖ‚òÖ –î–û–ë–ê–í–¨ –≠–¢–û–¢ –ë–õ–û–ö –î–õ–Ø –û–®–ò–ë–û–ö ‚òÖ‚òÖ‚òÖ -->
    <div class="messages" id="profileErrors">
        {% for message in messages %}
            {% if 'profile' in message.tags or 'username' in message.tags %}
                <div class="message {% if 'error' in message.tags %}error{% elif 'success' in message.tags %}success{% endif %}">
                    {{ message }}
                </div>
            {% endif %}
        {% endfor %}
    </div>
                <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
                <div class="messages">
                    {% for message in messages %}
                        <div class="message {% if 'error' in message.tags %}error{% elif 'success' in message.tags %}success{% endif %}">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
    <form method="post" enctype="multipart/form-data" action="{% url 'update_profile' %}">
        {% csrf_token %}
    <form method="post" enctype="multipart/form-data" action="{% url 'update_profile' %}" onsubmit="return validatePhoneBeforeSubmit()">
            <div class="form-group">
                <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                <input type="text" name="username" value="{{ user.username }}" required>
                <small style="color: #999; font-size: 12px;">–ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å, –µ—Å–ª–∏ –∏–º—è –Ω–µ –∑–∞–Ω—è—Ç–æ</small>
            </div>

            <!-- ‚òÖ‚òÖ‚òÖ –£–î–ê–õ–ò–õ –ø–æ–ª–µ email –æ—Ç—Å—é–¥–∞ ‚òÖ‚òÖ‚òÖ -->

            <div class="form-group">
                <label>–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                <input type="text" name="phone" value="{{ user.phone|default:'' }}" placeholder="+7 (XXX) XXX-XX-XX" oninput="validatePhone(this)">
            </div>
            <!-- ‚òÖ‚òÖ‚òÖ –î–û–ë–ê–í–¨ –ó–î–ï–°–¨ –ù–û–í–´–ï –ü–û–õ–Ø –î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø ‚òÖ‚òÖ‚òÖ -->
            <div class="form-group">
                <label>–ò–º—è:</label>
                <input type="text" name="first_name" value="{{ user.first_name|default:'' }}" placeholder="–í–∞—à–µ –∏–º—è">
            </div>

            <div class="form-group">
                <label>–§–∞–º–∏–ª–∏—è:</label>
                <input type="text" name="last_name" value="{{ user.last_name|default:'' }}" placeholder="–í–∞—à–∞ —Ñ–∞–º–∏–ª–∏—è">
            </div>

            <div class="form-group">
                <label>–û—Ç—á–µ—Å—Ç–≤–æ:</label>
                <input type="text" name="patronymic" value="{{ user.patronymic|default:'' }}" placeholder="–í–∞—à–µ –æ—Ç—á–µ—Å—Ç–≤–æ">
            </div>

            <div class="form-group">
                <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</label>
                <input type="date" name="birth_date" value="{{ user.birth_date|date:'Y-m-d'|default:'' }}">
            </div>

            <div class="form-group">
                <label>–ü–æ–ª:</label>
                <select name="gender">
                    <option value="">–ù–µ —É–∫–∞–∑–∞–Ω</option>
                    <option value="M" {% if user.gender == 'M' %}selected{% endif %}>–ú—É–∂—Å–∫–æ–π</option>
                    <option value="F" {% if user.gender == 'F' %}selected{% endif %}>–ñ–µ–Ω—Å–∫–∏–π</option>
                </select>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-cancel" onclick="closeEditSection('profile')">
                    ‚ùå –û—Ç–º–µ–Ω–∞
                </button>
                <button type="submit" class="btn btn-success">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                </button>
            </div>
        </form>
    </div>
</div>

<!-- ‚òÖ‚òÖ‚òÖ –î–û–ë–ê–í–¨ –≠–¢–£ –ù–û–í–£–Æ –°–ï–ö–¶–ò–Æ –î–õ–Ø –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø EMAIL ‚òÖ‚òÖ‚òÖ -->
<div class="section">
    <div class="section-title">
        <div class="section-title-text">
            <i>üìß</i> –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email
        </div>
    </div>

    <div class="info-item">
        <div class="info-label">–¢–µ–∫—É—â–∏–π email</div>
        <div class="info-value">
            {% if user.email %}
                {{ user.email }}
                {% with confirmation=user.email_confirmations.last %}
                    {% if confirmation and confirmation.confirmed_at %}
                        <br><small style="color: #28a745;">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω</small>
                    {% else %}
                        <br><small style="color: #dc3545;">‚ùå –ù–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω</small>
                    {% endif %}
                {% endwith %}
            {% else %}
                –ù–µ —É–∫–∞–∑–∞–Ω
            {% endif %}
        </div>
    </div>

    <form method="post" action="{% url 'verify_email' %}">
        {% csrf_token %}

        <div class="form-group">
            <label>–ù–æ–≤—ã–π email:</label>
            <input type="email" name="email" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π email"
                   value="{{ request.session.pending_email|default:'' }}">
        </div>

        <div class="form-group">
            <button type="submit" class="btn-2" name="send_code">
                üìß –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            </button>
        </div>

        <div class="form-group" id="codeGroup"
             {% if request.session.pending_email %}style="display: block;"{% else %}style="display: none;"{% endif %}>
            <label>–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:</label>
            <input type="text" name="confirmation_code" maxlength="6" placeholder="–í–≤–µ–¥–∏—Ç–µ 6 —Ü–∏—Ñ—Ä –∏–∑ –ø–∏—Å—å–º–∞">
        </div>

        {% if request.session.pending_email %}
        <div class="form-group">
            <button type="submit" class="btn btn-success">
                ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å email
            </button>
        </div>
        {% endif %}
    </form>
</div>
            <!-- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å -->
            <div class="section">
                <div class="section-title">
                    <div class="section-title-text">
                        <i>üîí</i> –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
                    </div>
                    <button class="edit-btn" onclick="openEditSection('password')">
                        üîë –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                    </button>
                </div>



                <div class="info-item">
                    <div class="info-label">–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥</div>
                    <div class="info-value">
                        {% if user.last_login %}
                            {{ user.last_login|date:"d.m.Y H:i" }}
                        {% else %}
                            –ù–∏–∫–æ–≥–¥–∞
                        {% endif %}
                    </div>
                </div>



                <!-- –§–æ—Ä–º–∞ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                <div class="edit-form" id="editPasswordForm">
                    <div class="section-title">
                        <div class="section-title-text">
                            <i>üîë</i> –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
                        </div>
                    </div>

                    <form method="post" action="{% url 'change_password' %}">
                        {% csrf_token %}

                        <div class="form-group">
                            <label>–°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å:</label>
                            <input type="password" name="old_password" required placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å">
                        </div>

                        <div class="form-group">
                            <label>–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label>
                            <input type="password" name="new_password" required placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
                        </div>

                        <div class="form-group">
                            <label>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label>
                            <input type="password" name="confirm_password" required placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-cancel" onclick="closeEditSection('password')">
                                ‚ùå –û—Ç–º–µ–Ω–∞
                            </button>
                            <button type="submit" class="btn btn-success">
                                üîí –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    </div>


    <script>


function openEditSection(section) {
    // –°–Ω–∞—á–∞–ª–∞ –∑–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    closeAllEditSections();

    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Ñ–æ—Ä–º—É
    let formElement;
    if (section === 'profile') {
        formElement = document.getElementById('editProfileForm');
        formElement.classList.add('active');
    } else if (section === 'password') {
        formElement = document.getElementById('editPasswordForm');
        formElement.classList.add('active');
    } else if (section === 'avatar') {
        formElement = document.getElementById('editAvatarForm');
        formElement.classList.add('active');
    }

    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –æ—Ç–∫—Ä—ã—Ç–æ–π —Ñ–æ—Ä–º–µ
    if (formElement) {
        formElement.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
        });
    }
}

function closeEditSection(section) {
    if (section === 'profile') {
        document.getElementById('editProfileForm').classList.remove('active');
    } else if (section === 'password') {
        document.getElementById('editPasswordForm').classList.remove('active');
    } else if (section === 'avatar') {
        document.getElementById('editAvatarForm').classList.remove('active');
    }
}

function closeAllEditSections() {
    document.getElementById('editProfileForm').classList.remove('active');
    document.getElementById('editPasswordForm').classList.remove('active');
    document.getElementById('editAvatarForm').classList.remove('active');
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –µ—Å–ª–∏ –µ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
document.addEventListener('DOMContentLoaded', function() {
    const messages = document.querySelectorAll('.message.error');
    if (messages.length > 0) {
        const errorText = messages[0].textContent.toLowerCase();

        if (errorText.includes('–ø–∞—Ä–æ–ª—å') || errorText.includes('password')) {
            openEditSection('password');
        } else if (errorText.includes('–∞–≤–∞—Ç–∞—Ä') || errorText.includes('avatar')) {
            openEditSection('avatar');
        } else if (errorText.includes('–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å') || errorText.includes('username') || errorText.includes('–∏–º—è')) {
            openEditSection('profile');
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –æ—à–∏–±–∫–µ
            document.getElementById('profileErrors').scrollIntoView({ behavior: 'smooth' });
        } else {
            openEditSection('profile');
        }
    }
});

// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
function validatePhone(input) {
    // –£–¥–∞–ª—è–µ–º –≤—Å—ë –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä, +, (), -
    let phone = input.value.replace(/[^\d+()-\s]/g, '');

    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É (–º–∞–∫—Å–∏–º—É–º 20 —Å–∏–º–≤–æ–ª–æ–≤)
    if (phone.length > 20) {
        phone = phone.substring(0, 20);
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    if (phone.startsWith('+7') || phone.startsWith('7') || phone.startsWith('8')) {
        // –†–æ—Å—Å–∏–π—Å–∫–∏–π –Ω–æ–º–µ—Ä - —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∫–∞–∫ +7 (XXX) XXX-XX-XX
        let digits = phone.replace(/\D/g, '');

        if (digits.startsWith('7') || digits.startsWith('8')) {
            digits = '7' + digits.substring(1);
        }

        if (digits.length >= 1) {
            phone = '+7';
            if (digits.length > 1) {
                phone += ' (' + digits.substring(1, 4);
            }
            if (digits.length > 4) {
                phone += ') ' + digits.substring(4, 7);
            }
            if (digits.length > 7) {
                phone += '-' + digits.substring(7, 9);
            }
            if (digits.length > 9) {
                phone += '-' + digits.substring(9, 11);
            }
        }
    }

    input.value = phone;
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
function validatePhoneBeforeSubmit() {
    const phoneInputs = document.querySelectorAll('input[name="phone"]');
    phoneInputs.forEach(input => {
        const phone = input.value.replace(/\D/g, ''); // –¢–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã
        if (phone && phone.length < 11) {
            alert('–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 11 —Ü–∏—Ñ—Ä');
            input.focus();
            return false;
        }
    });
    return true;
}

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –¥–ª—è –∫–æ–¥–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ email
document.addEventListener('DOMContentLoaded', function() {
    const emailField = document.querySelector('input[name="email"]');
    const codeGroup = document.getElementById('confirmationCodeGroup');

    // –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –¥–ª—è –∫–æ–¥–∞ (—É–ø—Ä–æ—Å—Ç–∏–º –ª–æ–≥–∏–∫—É)
    if (codeGroup) {
        codeGroup.style.display = 'block';
    }

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ email
    if (emailField && codeGroup) {
        emailField.addEventListener('input', function() {
            codeGroup.style.display = 'block';
        });
    }
});

    </script>
</body>
</html>